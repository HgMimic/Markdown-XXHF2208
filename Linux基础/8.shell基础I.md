# shell 基础

shell 在 Linux 系统中是命令解释器，为用户和操作系统之间通信提供的一种接口，用户通过应用程序或部分系统软件发出指令，这些指令会被翻译并传给内核从而达到使用计算机资源的目的。  
shell 也是一种解释型编程语言（脚本语言），编写后不需要做任何编译就可以运行。

shell 有多种，可在 `/etc/shells` 文件中进行查看

> `/bin/sh` #是 `/bin/bash` 的软链接  
> `/bin/bash` #最常用的 shell，Bourne Again SHell  
> `/sbin/nologin` #不能登录系统的 shell，常用于某些系统账户  
> `/bin/dash` #C7 目录下无此 shell  
> `/bin/tcsh` #C7 目录下无此 shell  
> `/bin/csh` #C7 目录下无此 shell

## `echo` 命令

`echo -e 内容` 支持反斜线（转义字符）控制的字符转换  
`echo -n 内容` 取消输出后行末的换行符号，即内容输出后，不换行

**控制字符**：

| 字符 | 作用                                   |
| ---- | -------------------------------------- |
| `\\` | 输出 `\` 本身                          |
| `\a` | 输出警告音                             |
| `\b` | 退格键，向左删除                       |
| `\f` | 换页符，换行且在上一行结束位置开始输出 |
| `\n` | 换行符                                 |
| `\t` | 制表符（TAB 键），对齐下一列           |

> - `\b` 仅在右侧有其他非控制字符时才生效,多个连用会向左删除多个字符。
> - 在命令行中使用 `\` （后面不加内容），表示输入未完成，下一行继续输入。
> - 颜色输出： `\e[5;1;31m EXAMPLE \e[0m` 为输出内容赋予颜色及格式。

## shell 脚本的执行方式

1. 绝对路径或相对路径，在子 shell（child shell）中执行，只继承父 shell 的环境变量，而不继承自定义变量。需要有 x 权限，且声明解释器 shell 类型（开头的 `#!/bin/bash` ）。
2. `bash 脚本文件` 或 `/bin/bash 脚本文件` ，同上在子 shell 中执行，不需要 x 权限。
3. `source 脚本文件` 或 `. 脚本文件` ，在当前 shell 中执行，不需要 x 权限。

## `cat <<EOF` 命令使用方式

```bash
cat <<EOF
EXAMPLE
EOF
#输出重定向，EOF之间的内容会完整输入 cat ，由 cat 显示出来。

cat <<EOF >> ./test.txt
EXAPMLE
EOF
#可以将内容输出重定向到文件中
```

> `EOF` 可用是任意字符，只要前后对应即可，EOF 只是约定的标准。  
> `cat <<EOF` 适合输出多行、带有格式的内容（相比 echo）。  
> 注意 `cat <EOF` 是错误写法，不要记错。

## bash 的主要功能

### `history` 功能

- `history` 显示在 bash 终端中执行的命令的历史记录，默认记录 1000 条，可在 `/etc/profile` 文件中修改 `HISTSIZE` 的值。
- 命令历史记录同样分用户保存在家目录下的 `~/.bash_history` 文件内，但是本次登录后执行的命令记录默认在退出登录后才会存入本文件。
- `history -w` 会将本次登录执行的命令记录写入 `~/.bash_history` 文件。
- `history -c` 会清空当前的历史命令记录。
  > 暂时清空 `history` 命令的记录，不会清空 `~/.bash_history` 文件内容，下次登陆之后 `hisroty` 命令的记录又会从文件中恢复出来，只是少了上次登陆后执行此命令之前的记录。

### TAB 补全功能

补全功能可以让用户在操作时能提高速度和准确性。  
C7 中的补全功能不仅能补全命令，还能补全命令之后的选项，启动服务的名称等。

### 别名功能

`alias 别名='实际执行的命令'` 临时定义别名。  
定义别名命令写入 `~/.bashrc` 对当前用户生效，写入 `/etc/bashrc` 对所有用户生效。

`unalias <命令>` 临时取消指定命令的相关别名。  
`unalias -a` 临时取消所有命令的别名。

### `hash` 命令

**`PATH` 作为一个环境变量，其值为系统能直接通过文件名执行的可执行文件的所在目录路径列表，用 `:` 分隔，默认最后一个路径为当前用户家目录下的 bin 目录，即 `~/bin` 。**  
Linux 系统下有一个 hash 表，记录**当前登录**中，命中 PATH 中的命令，及其使用次数。  
下次使用相同命令，可以先查 hash 表，节省找 PATH 的资源和时间浪费。

> 只保存命中数（使用频率）较多的一定条目。

`hash -p <实际执行的命令的绝对路径> <命令行中输入的命令>` 向 hash 表中手动加入一个条目。  
`hash -r` 清空 hash 表。

### 命令执行的优先顺序

绝对路径 > 别名 > hash 表 > PATH

### bash 常用快捷键

> 之前记过很多，此处只记几个重要的和新的。

| 快捷键   | 作用                                           |
| -------- | ---------------------------------------------- |
| `Ctrl+k` | 剪切光标及之后的内容                           |
| `Ctrl+r` | 在历史命令中搜索并切换到命令行上               |
| `Ctrl+d` | 退出当前终端（ `exit` )                        |
| `Ctrl+s` | 暂停屏幕输出（画面暂停，键盘输入实际不受影响） |
| `Ctrl+d` | 恢复屏幕输出                                   |

### 输入输出重定向

| 设备文件名    | 文件描述符 | 类型         |
| ------------- | ---------- | ------------ |
| `/dev/stdin`  | 0          | 标准输入     |
| `/dev/stdout` | 1          | 标准输出     |
| `/dev/stderr` | 2          | 标准错误输出 |

> 标准输入输出重定向不再赘述。

`错误命令 2> 文件` 将标准错误输出覆盖重定向到文件。  
`错误命令 2>> 文件` 将标准错误输出追加重定向到文件。

`命令 &> 文件` 或 `命令 > 文件 2>&1` 将标准输出和标准错误输出覆盖重定向到文件。  
`命令 &>> 文件` 或 `命令 >> 文件 2>&1` 将标准输出和标准错误输出追加重定向到文件。

`命令 >> 文件1 2>> 文件2` 将标准输出追加重定向到文件 1，将标准错误输出追加重定向到文件 2

### 其他命令

`df -h | tee ./disk.log` 将 `df -h` 命令的输出覆盖式重定向到文件，且输出到标准输出设备（命令行终端）。

> `tee -a 文件` 可以将内容追加重定向到文件，且输出到标准输出设备。

`wc 内容` 统计字符相关信息。

> 行（ `-l` )，单词（ `-w` ），字（ `-c` ）的数量。  
> `wc < 文件` 重定向方式，将文件中的字符交由 wc 统计，而非文件本身（输出内容后面无文件名）。

### `grep` 命令：字符串过滤

`grep 子选项 "关键词" 文件名`

> `-An` 列出符合条件的行及后续 n 行。  
> `-Bn` 列出符合条件的行及前面 n 行。  
> `-c` 仅列出符合条件的行数。  
> `-i` 忽略关键词大小写。  
> `-n` 在结果前输出所在行号。  
> `-v` 反向查找（取反）。  
> `-o` 只列出关键字。

## 通配符

通配符用于 shell 命令行或脚本中

> 正则表达式则用于字符串处理

| 通配符 | 作用                             |
| ------ | -------------------------------- |
| `?`    | 匹配任意字符，一次               |
| `*`    | 匹配任意字符，任意次（0-n）      |
| `[]`   | 匹配中括号内任意一个字符，一次   |
| `[-]`  | 匹配范围内任意一个字符，一次     |
| `[^]`  | 匹配非中括号内任意一个字符，一次 |

## 特殊符号

| 符号   | 作用                                                                                                |
| ------ | --------------------------------------------------------------------------------------------------- |
| `''`   | 其中是一个字符串整体，内容原样输出，符号无特殊含义                                                  |
| `""`   | 其中是一个字符串整体，内容经过解释后输出，符号具有其特殊含义                                        |
| ` `` ` | 其中的内容会当成命令来执行，将执行结果作为输出，其容易与单引号混淆，不推荐使用                      |
| `$()`  | 其中的内容会当成命令来执行，将执行结果作为输出，更推荐使用，因为不易混淆                            |
| `()`   | 其中的命令会在 sub shell 中运行，其类似一个父 shell 的完整克隆，继承了父 shell 的所有变量           |
| `{}`   | 其中的命令会在当前 shell 中执行，也可以用于变量变形与替换， `{` 后必须有空格， `}` 前必须有分号 `;` |
| `[]`   | 用于条件测试，输出布尔值                                                                            |
| `#`    | 其开头的内容会视为注释                                                                              |
| `$`    | 用于调用变量的值                                                                                    |
| `\`    | 转义符，用于使特殊符号失去特殊含义或使普通字符具有特殊含义                                          |
